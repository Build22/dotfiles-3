" Ctrlp - Vimscript fuzzy file opener

Bundle "kien/ctrlp.vim"

" Make CtrlP use ag for listing the files. Way faster and no useless files.
let g:ctrlp_user_command = 'ag %s -l --nocolor -g ""'
let g:ctrlp_use_caching = 0

let g:ctrlp_match_window_bottom = 0
let g:ctrlp_working_path_mode = 'r'
let g:ctrlp_match_window_reversed = 0
let g:ctrlp_mruf_default_order = 1
let g:ctrlp_max_height = 45
let g:ctrlp_max_files = 300
let g:ctrlp_max_depth = 99
let g:ctrlp_prompt_mappings = {
\ 'MarkToOpen()':         ['<c-z>', '<c-x>'],
\ 'PrtExit()':            ['<esc>', '<c-c>', '<c-g>', '<C-@>', '<c-space>'],
\ }

function! CtrlpRelativeRoot(path)
    CtrlPClearAllCaches
    call CD_Git_Root()
    let rails_root = getcwd()
    execute join([":CtrlP", rails_root.'/'.a:path])
endfunction

nnoremap <leader>gc :call CtrlpRelativeRoot("app/controllers")<cr>
nnoremap <leader>gf :call CtrlpRelativeRoot("features")<cr>
nnoremap <leader>gj :call CtrlpRelativeRoot("app/assets/javascripts")<cr>
nnoremap <leader>gl :call CtrlpRelativeRoot("lib")<cr>
nnoremap <leader>gm :call CtrlpRelativeRoot("app/models")<cr>
nnoremap <leader>gs :call CtrlpRelativeRoot("spec")<cr>
nnoremap <leader>gt :call CtrlpRelativeRoot("app/assets/templates")<cr>
nnoremap <leader>gv :call CtrlpRelativeRoot("app/views")<cr>
nnoremap <leader>gw :call CtrlpRelativeRoot("app/workers")<cr>
nnoremap <leader>gy :call CtrlpRelativeRoot("app/assets/stylesheets")<cr>

nmap <LEADER>rf :CtrlP ~/.vim/rcfiles<cr>
nmap <LEADER>rp :CtrlP ~/.vim/rcplugins<cr>

nnoremap <leader>cpt :CtrlPTag<cr>
nnoremap <leader>cpl :CtrlP =expand('%:p:h')<cr><cr>

" vim:ft=vim
