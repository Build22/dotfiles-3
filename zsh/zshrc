# Path to your oh-my-zsh configuration.
export ZSH=$HOME/.oh-my-zsh
plugins=(rvm zsh-syntax-highlighting vagrant heroku brew gem gitfast)
export DISABLE_AUTO_UPDATE="true" # Don't let oh-my-zsh auto update
export ZSH_THEME="cjt" # Zsh theme, loaded from ~/.oh-my-zsh/themese. Set to 'random' for fun
source $ZSH/oh-my-zsh.sh

export BUNDLER_EDITOR='vim'

export HOMEBREW_CASK_OPTS="--appdir=/Applications"

[[ -r "$HOME/.auth" ]] && export `cat $HOME/.auth`

alias vim='mvim -v'
alias vi='mvim -v'

# Prevent correct of git slog
alias be='bundle exec'

## case-insensitive (all),partial-word and then substring completion
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}' \
    'r:|[._-]=* r:|=*' 'l:|=* r:|=*'

# Quick jumping to ~/code & $HOME directories
c(){cd ~/code/$1;}
compctl -M 'm:{a-z}={A-Z}' -W ~/code -/ c
h(){cd ~/$1;}
compctl -M 'm:{a-z}={A-Z}' -W ~/ -/ h

# List all symlinks in current directory #TODO where do they point?
lns() { find ./ -type l -maxdepth 1 | awk '{ sub(/.\/+/, ""); print }' }
lnsm() { find -L ./ -maxdepth 1 -type l | awk '{ sub(/.\/+/, ""); print }' }

function rake() {
  if [ -S .zeus.sock ]; then
    zeus rake "$@"
  else
    bundle exec command rake "$@"
  fi
}

function z {
  if [[ $# > 0 ]]; then
    zeus $@
  else
    if [ -S .zeus.sock ]; then
      zeus console
    else
      zeus start
    fi
  fi
}
# alias zc="zeus console"
# alias zr="zeus rake"

function rsup() {
  app_name=$(basename `pwd`)
  port=`cat ~/.pow/$app_name 2> /dev/null`
  if [[ -n $port ]]; then
    bundle exec rails s -p $port
  else
    bundle exec rails s
  fi
}
function ropen() { open "http://`basename $(pwd)`.dev" }

# Serve the current directory. Pass in a port, or use default 8000
function simple_serve { $(which python) -m SimpleHTTPServer ${1:-8000} }

alias pow=powder

alias ql='qlmanage -p "$@" > /dev/null'

function trash() { mv $1 ~/.Trash }

function mkcd() { mkdir $1 && cd $1 }

compdef g=git
function g {
  if [[ $# > 0 ]]; then
    git $@
  else
    git status --short --branch
  fi
}

function current_branch() {
    ref=$(git symbolic-ref HEAD 2> /dev/null) || return
    echo ${ref#refs/heads/}
}

function gitup {
    if git rev-parse --git-dir > /dev/null 2>&1; then
        cd "./"$(git rev-parse --show-cdup)
    else
        return
    fi
}

function gitcount {
    commit_count=`git log --pretty=oneline | wc -l | awk '{print $1}'`
    echo "  -> Total commits to date: $commit_count"
}

alias iphonesim='open /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/Applications/iPhone\ Simulator.app'
function ipaddress { ifconfig en0 | grep 'inet\s' | awk '{print $2}' }

function ackjs { ack $1 --js app/assets/javascripts }
function ackvim { ack $1 -a ~/code/dotfiles/vim/vimrc ~/code/dotfiles/vim/rcplugins/ ~/code/dotfiles/vim/rcfiles/ }

function agl { ag -l --nocolor -g "$1" | sed 's/^\.\///' }

function dbpullheroku {heroku db:pull --app $(production_app_name) --confirm $(production_app_name)}

function heroku_url { heroku apps:info -r $1 | grep -i web  | tr -s ' ' | cut -d ' ' -f 3 }

# Convenice aliases
alias ls="ls -FG"
alias l="ls -l"
alias la="ls -la"

alias ez='vim ~/.zshrc'
alias sz='source ~/.zshrc'

export OPSCODE_USER=christoomey

# Load .env file into shell session for config vars
function envup {
  if [ -f .env ]; then
    export `cat .env`
  else
    return 1
  fi
}

# Allow [ or ] whereever you want
unsetopt nomatch

# Do not autoupdate tmux window titles
export DISABLE_AUTO_TITLE="true"

# Tmux aliases
alias tls="tmux list-sessions"
alias tka="tmux kill-session"
function tb { tmux break-pane -d -t $1 }
function tk {
  current_session=$(tmux display-message -p '#S')
  tmux switch-client -n
  tmux kill-session -t "$current_session"
}
function ta {
    if [ -z "$1" ]; then
        tmux attach
    else
        tmux attach-session -t $1
    fi
}
function tn {
  if [ -z "$1" ]; then
      session_name=$(basename `pwd`)
  else
      session_name=$1
  fi
  tmux new-session -d -s $session_name -n vim
  if [ -f zeus.json ]; then
    tmux new-window -t $session_name -n zeus 'zeus start' C-m
    # tmux split-window -t lplive:2.0 -h 'be foreman start web' C-m
    # tmux select-window -t $session_name:1
  fi
  tmux attach-session -t $session_name
}

# Don't attempt spelling autocorrect
unsetopt correct_all

# Customize to your needs...
export PATH=$HOME/local/bin:$PATH:$HOME/bin:/usr/local/mysql/bin:/opt/local/bin:/opt/local/sbin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/git/bin:/usr/X11/bin

# use .localrc for settings specific to one system
[[ -f ~/.localrc ]] && . ~/.localrc

[[ -s $HOME/.rvm/scripts/rvm ]] && source $HOME/.rvm/scripts/rvm

PATH=$PATH:$HOME/.rvm/bin # Add RVM to PATH for scripting
