#!/bin/bash
#
# starts rails or middleman server
# opens with the port configured for pow DNS
# copies the ".dev" URL

app_name=$(basename `pwd`)
port=`cat ~/.pow/$app_name 2> /dev/null`

if [[ -f .env ]]; then
  export $(cat .env)
fi

if [[ -f config/environment.rb ]]; then
  server_cmd="bundle exec rails s"
elif [[ -f config.rb ]] && [[ -d source ]]; then
  server_cmd="middleman"
elif [[ -f package.json ]]; then
  server_cmd="grunt"
else
  echo 'Error: Unable to determine server command for current directory' 1>&2
  exit 1
fi

if [[ -n $port ]]; then
  echo "http://`basename $(pwd)`.dev" | pbcopy
  echo "Dev URL loaded into clipboard"
  eval $server_cmd -p $port
else
  echo "http://localhost:3000" | pbcopy
  echo "Dev URL loaded into clipboard"
  eval $server_cmd
fi
